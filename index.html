function doPost(e) {
  try {
    const sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    const data = JSON.parse(e.postData.contents);
    
    // Add headers if sheet is empty
    if (sheet.getLastRow() === 0) {
      sheet.appendRow([
        'Timestamp', 'School Name', 'School Address', 'Assessment Title',
        'Assessment Type', 'Client Type', 'Surname', 'First Name', 
        'Middle Name', 'Middle Initial', 'Name Extension',
        'Street', 'Barangay', 'District', 'City', 'Province', 
        'Region', 'Zip Code', 'Mother Name', 'Father Name',
        'Sex', 'Civil Status', 'Tel', 'Mobile', 'Email', 'Fax',
        'Education', 'Employment', 'Birthdate', 'Birthplace', 'Age',
        'Work Experience', 'Training/Seminars', 'Licensure Exams',
        'Competency Assessments', 'Photo', 'Signature'
      ]);
    }
    
    // Add data row
    sheet.appendRow([
      new Date(),
      data.schoolName, data.schoolAddress, data.assessmentTitle,
      data.assessmentType, data.clientType, data.surname, data.firstname,
      data.middleName, data.middleInitial, data.nameExtension,
      data.mailingStreet, data.mailingBarangay, data.mailingDistrict,
      data.mailingCity, data.mailingProvince, data.mailingRegion,
      data.mailingZipCode, data.motherName, data.fatherName,
      data.sex, data.civilStatus, data.contactTel, data.contactMobile,
      data.contactEmail, data.contactFax, data.educationalAttainment,
      data.employmentStatus, data.birthdate, data.birthplace, data.age,
      data.workExperience, data.trainingSeminars, data.licensureExams,
      data.competencyAssessments, 'Photo uploaded', 'Signature captured'
    ]);
    
    return ContentService.createTextOutput(JSON.stringify({
      status: 'success',
      message: 'Application submitted successfully'
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      status: 'error',
      message: error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}
